apiVersion: v1
kind: ConfigMap
metadata:
  name: discover-config
  namespace: default
  annotations:
    argocd.argoproj.io/sync-options: Delete=false
    platform.akachat.io/shared-resource: "true"
data:
  discovery.yml: |
    enable: "etcd"
    kubernetes:
      namespace: default
    etcd:
      rootDirectory: akachat
      address: [ 'etcd-headless.component.svc.cluster.local:2379' ]
      username: ''
      password: ''

  admin.yml: |
    tokenPolicy:
      expire: 90

    secret: chat123

  log.yml: |
    # Log storage path, default is acceptable, change to a full path if modification is needed
    storageLocation: ../../../../logs/
    # Log rotation period (in hours), default is acceptable
    rotationTime: 24
    # Number of log files to retain, default is acceptable
    remainRotationCount: 2
    # Log level settings: 3 for production environment; 6 for more verbose logging in debugging environments
    remainLogLevel: 6
    # Whether to output to standard output, default is acceptable
    isStdout: false
    # Whether to log in JSON format, default is acceptable
    isJson: false
    # output simplify log when KeyAndValues's value len is bigger than 50 in rpc method log
    isSimplify: true

  mysqldb.yml: |
    # URI for database connection, leave empty if using address and credential settings directly
    uri: "imDiscover:1mD1sC0v3rStag2025@tcp(rm-d9jsd89edn3459ce2.mysql.ap-southeast-5.rds.aliyuncs.com:3306)/aka_discovers?charset=utf8mb4&parseTime=True&loc=Local"
    # Hostname or IP address of PostgreSQL server
    host: rm-d9jsd89edn3459ce2.mysql.ap-southeast-5.rds.aliyuncs.com
    # Port of PostgreSQL server
    port: 3306
    # Name of the database
    database: aka_discovers
    # Username for database authentication
    username: imDiscover
    # Password for database authentication
    password: 1mD1sC0v3rStag2025
    # SSL mode (disable, require, verify-ca, verify-full)
    sslmode: disable
    # Maximum number of open connections in the pool
    maxOpenConns: 300
    # Maximum number of idle connections in the pool
    maxIdleConns: 30
    # Maximum number of retry attempts for a failed database connection
    maxRetry: 10
    # Connection timeout in seconds
    connectTimeout: 5

  redis.yml: |
    address: [ 'r-d9jj3sgajitxtqb1h6.redis.ap-southeast-5.rds.aliyuncs.com:6379' ]
    username: 'default'
    password: '5YkuUQ7cAJ4CC622'
    clusterMode: false
    db: 0
    maxRetry: 10
    poolSize: 100
    tls:
      enableTLS: false
      serverName: 

  discover-api.yml: |
    api:
      # Listening IP; 0.0.0.0 means both internal and external IPs are listened to, default is recommended
      listenIP: 0.0.0.0
      # Listening ports; if multiple are configured, multiple instances will be launched
      ports: [ 10013 ]
      # API compression level; 0: default compression, 1: best compression, 2: best speed, -1: no compression
      compressionLevel: 0

    prometheus:
      enable: true
      autoSetPorts: true
      ports: [ 14002 ]
      grafanaURL: https://grafana.0dev.cc/

  share.yml: |
    openIM:
      # OpenIM API address
      apiURL: http://im-api-service:10002
      # OpenIM secret key, must be consistent with OpenIM
      secret: sIpdsOSGLsCfeN5q093cWdI3t
      # OpenIM administrator userID, must be consistent with OpenIM
      adminUserID: imAdmin

    discoverAdmin:
      # Default username and password for the admin
      - "discoverAdmin"

    dbOption: mysql

  tracer.yml: |
    appName:
      api: "discover-api"
    otel:
      collector:
        address: "otel-collector.monitoring.svc.cluster.local:4317"
    enable: true