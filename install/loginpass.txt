kubectl apply -f install/argocd-install-3.1.0.yml \
-f install/argocd-install-loadbalances.yml -n argocd
kubectl apply -f install/plugin-image-updater.yml -n argocd
kubectl delete -f install/argocd-install-3.1.0.yml \
-f install/argocd-install-loadbalances.yml -n argocd

kubectl delete -f  install/argocd-install-loadbalances.yml -n argocd
kubectl apply -f  install/argocd-install-loadbalances.yml -n argocd

kubectl -n argocd get secret argocd-initial-admin-secret -o \
jsonpath="{.data.password}" | base64 -d

lNSn3SDCCJ5dRVde

kubectl create namespace argocd


kubectl apply -f argocd-grpc-service.yml -f argocd-install-3.1.0.yml -f plugin-image-updater.yml -f argocd-alb-loadbalances.yml -n argocd

kubectl delete -f plugin-image-updater.yml -n argocd

kubectl apply -f plugin-image-updater.yml -n argocd

// alb 
aws iam list-open-id-connect-providers
aws eks describe-cluster \
  --name akachat-develop \
  --region ap-southeast-3 \
  --query "cluster.identity.oidc.issuer" \
  --output text

aws iam create-open-id-connect-provider \
  --url https://oidc.eks.ap-southeast-3.amazonaws.com/id/799E49CCE45E1649781807B928E4D164 \
  --client-id-list sts.amazonaws.com \
  --thumbprint-list 9e99a48a9960b14926bb7f3b02e22da0ecd4e4e3
eksctl utils associate-iam-oidc-provider --region ap-southeast-3  --cluster akachat-develop --approve

eksctl create iamserviceaccount \
  --cluster=akachat-develop \
  --namespace=kube-system \
  --name=aws-load-balancer-controller \
  --role-name=AmazonEKSLoadBalancerControllerRole \
  --attach-policy-arn=arn:aws:iam::207834821696:policy/AWSLoadBalancerControllerIAMPolicy \
  --approve \
  --override-existing-serviceaccounts

eksctl create iamserviceaccount \
  --cluster akachat-develop --region ap-southeast-3 \
  --namespace kube-system \
  --name aws-load-balancer-controller \
  --attach-policy-arn arn:aws:iam::207834821696:policy/AWSLoadBalancerControllerIAMPolicy \
  --override-existing-serviceaccounts \
  --approve


helm install aws-load-balancer-controller eks/aws-load-balancer-controller \
-n kube-system \
--set clusterName=akachat-develop \
--set serviceAccount.create=true \
--set serviceAccount.name=aws-load-balancer-controller \
--set region=ap-southeast-3 \
--set vpcId=vpc-0c3c29e20a20a88b0 \
--version 1.13.4
OIDC 提供者不匹配：原来的角色是为 ap-southeast-1 集群创建的
需要为当前 akachat-develop 集群创建正确的 OIDC 提供者和 IAM 角色